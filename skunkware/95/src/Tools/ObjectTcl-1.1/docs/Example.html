<HTML><HEAD>
<!-- Version: @(#) Example.html 1.2 -->
<!-- Copyright (C) 1995 IXI Limited -->
<TITLE>Object Tcl - Example</TITLE>
<LINK rev="Made" href = "mailto:otcl@x.co.uk">
<LINK rel="Contents" href="cover.html">
<LINK rel="Previous" href="BindingRef.html">
<LINK rel="Next" href="../../../src/Tools/ObjectTcl-1.1">
</HEAD><BODY>

<IMG SRC="ObjectTcl.gif">

<H2>Introduction</H2>

<P>This page provides a simple example of how to:
<UL>
<LI>Export C++ classes to the Object Tcl system
<LI>Describe new classes in Object Tcl
<LI>Inherit Object Tcl classes from C++ classes
<LI>Build an augmented Tcl shell
<LI>Manipulate Object Tcl objects
</UL> 

<H2>C++ Class</H2>

Class <code>A</code> is a simple C++ class that maintains a reference (pointer) to
another class <code>A</code> object and provides three methods. The first method,
<code>doIt</code>, is a virtual method that prints a simple message identifying
itself as class <code>A</code>'s version of <code>doIt</code>. The second method,
<code>doItNext</code>, invokes the <code>doIt</code> method upon the other class <code>A</code>
object referenced by the private attribute <code>next</code>. The final method,
<code>setNext</code>, can be used to set the <code>next</code> class <code>A</code> object
reference.

<P>Class <code>A</code> is described and implemented in C++ in the following two
files:

<H3>File A.H</H3>

<PRE>
#ifndef A_H
#define A_H

// File A.H

class A
{
public:
   A (A *next);			// Constructor member function
   virtual ~A ();		// Destructor member function
   virtual void doIt (void);	// Virtual member function
   void doItNext (void);	// Member function
   void setNext (A *obj);	// Member function
private:
   A *next;			// Member variable
};

#endif // A_H
</PRE>

<H3>File A.C</H3>

<PRE>
#include &lt;iostream.h&gt;
#include "A.H"

// File A.C

A::A (A *n)
{
   next = n;
   cout &lt;&lt; "A::constructed" &lt;&lt; endl;
}

A::~A ()
{
   cout &lt;&lt; "A::destructed" &lt;&lt; endl;
}

void A::doIt (void)
{
   cout &lt;&lt; "A::doIt" &lt;&lt; endl;
}

void A::setNext (A *n)
{
   next = n;
}

void A::doItNext (void)
{
   if (next != NULL)
   { 
      next-&gt;doIt();	// "doIt" is dynamically bound so it could be the
			// "doIt" of class A or a subclass of A.
   }
}
</PRE>

<H2>Exporting C++ Class A to Object Tcl</H2>

<P>The following file contains the CDL for class <code>A</code>. This file
may be processed by the 
<a href="BindingRef.html">CDL processor</a> and the resulting C++ files linked
into the final application.

<PRE>
# File A_cdl.cdl

pass {
// Generated from A_cdl.cdl
#include "A.H"
#include "A_cdl.H"
}

class A {
   constructor {obref A}
   method doIt -dynamic {void} {void}	# "doIt" required dynamic binding
   method doItNext -static {void} {void}
   method setNext -static {obptr A} {void}
   # The "A" after the obref type indicates the actual type of the
   # parameter expected by the "setNext" method.
}
</PRE>

<H2>An Object Tcl Class</H2>

<P>Class <code>B</code> is a new class described in Object Tcl, below, that inherits
from class <code>A</code>.

<P>Class <code>B</code> provides its own version of the <code>doIt</code> method, that
is also defined in class <code>A</code>. Class <code>B</code>'s version of the <code>doIt</code>
method prints a simple message identifying itself and then calls the
<code>doIt</code> method of its parent class (<code>A</code>).

<PRE>
# File B.tcl

otclInterface B -isA A {
   constructor {next value}
   method doIt {}	# Redefines the "doIt" method available in class A
}

otclImplementation B {
   # The constructor method passes on its first argument up to
   # the constructor of the "A" parent class.
   constructor {n v} {{A $n}} {
      set value $v
      puts "B::constructed with value $value"
   }
   destructor {
      puts "B::destructed"
   }
   # The new version of the "doIt" method.
   method doIt {} {
      puts "B::doIt, value is $value, calling A::doIt"

      # Invoke the "doIt" method but make sure it is the version
      # of the "A" parent class and this version that would be
      # chosen by default using dynamic binding.
      $this -A doIt
   }
   attribute value
}
</PRE>

<H2>Building</H2>

<P>To build a version of the Tcl shell (tclsh) that includes the Object Tcl package,
with class <code>A</code> and class <code>A</code> exported to Object Tcl, perform the 
following:

<ol>

<li>Compile class <code>A</code>:

<PRE>
system% <kbd>CC -c A.C</kbd>
</PRE>

<li>Process the CDL for class <code>A</code>:

<PRE>
system% <kbd>cdl -h A_cdl.cdl A_cdl.H</kbd>
system% <kbd>cdl -s A_cdl.cdl A_cdl.C</kbd>
</PRE>

<li>Compile the C++ code generated by the processing of <code>A</code>'s CDL
description:

<PRE>
system% <kbd>CC -I$(OTCL) -I$(TCL) -c A_cdl.C</kbd>
</PRE>

<li>Link the object files together using a C++ linker:

<PRE>
system% <kbd>CC -o examplesh -L$(OTCL) -L$(TCL) A.o A_cdl.o \
$(OTCL)/tclAppInit.o -lotcl -ltcl -lm</kbd>
</PRE>

</ol>

<P>Note: the files <code>tclAppInit.o</code> and <code>tclMain.o</code> are modified
version of the files from the tcl7.3 distribution. These files have been
modified to initialize the Object Tcl package and compile under C++.

<H2>Testing</H2>

<P>To test the augmented Tcl shell:

<PRE>
system% <kbd>./examplesh</kbd>
% <kbd>source TestB.tcl</kbd>
About to construct an instance of class A
A::constructed

About to call method doIt on instance of class A
A::doIt

About to construct an instance of class B
A::constructed
B::constructed with value 5

About to call method doIt on instance of class B
B::doIt, value is 5, calling A::doIt
A::doIt

Setting instance of class A to point at instance of class B
About to call method doItNext on instance of class A
B::doIt, value is 5, calling A::doIt
A::doIt

About to destruct instance of class A
A::destructed

About to destruct instance of class B
B::destructed
A::destructed
% 
</PRE>

<P>Where <code>TestB.tcl</code> is:

<PRE>
# TestB.tcl

puts "About to construct an instance of class A"
set a [otclNew A ""]

puts "\nAbout to call method doIt on instance of class A"
$a doIt

source B.tcl
puts "\nAbout to construct an instance of class B"
set b [otclNew B "" 5]

puts "\nAbout to call method doIt on instance of class B"
$b doIt

puts "\nSetting instance of class A to point at instance of class B"
$a setNext $b
puts "About to call method doItNext on instance of class A"
$a doItNext

puts "\nAbout to destruct instance of class A"
otclDelete $a

puts "\nAbout to destruct instance of class B"
otclDelete $b
</PRE>

<P><IMG ALIGN=MIDDLE SRC="/skunkware/pics/gif/buttons/line.blue.gif" ALT=""><P>
<A REL="Contents" HREF = "cover.html">Object Tcl</A> |
<A HREF = "Overview.html">Overview</A> |
<A HREF = "LangRef.html">Language Reference</A> |
<A REL="Previous" HREF = "BindingRef.html">C++ Binding Reference</A> |
Example |
<A REL="Next" HREF = "../../../src/Tools/ObjectTcl-1.1"><b>Source Code</b></A>

<P><IMG ALIGN=MIDDLE SRC="/skunkware/pics/gif/buttons/line.blue.gif" ALT=""><P>

<ADDRESS><A HREF = "mailto:otcl@x.co.uk">otcl@x.co.uk</A></ADDRESS>

<P><IMG ALIGN=MIDDLE SRC="/skunkware/pics/gif/buttons/line.blue.gif" ALT="">
<P><A HREF="/skunkware/index.html">
<IMG ALIGN=MIDDLE SRC="/skunkware/pics/gif/buttons/arrow.plain.left.gif"
ALT="">
Return to Welcome Home Page</A> or
<A HREF="cover.html">
Continue to Browse
<IMG ALIGN=MIDDLE SRC="/skunkware/pics/gif/buttons/arrow.plain.right.gif"
ALT=""></A>
</BODY></HTML>
