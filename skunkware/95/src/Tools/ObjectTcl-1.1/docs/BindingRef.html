<HTML><HEAD>
<!-- Version: @(#) BindingRef.html 1.2 -->
<!-- Copyright (C) 1995 IXI Limited -->
<TITLE>Object Tcl - C++ Binding Reference</TITLE>
<LINK rev="Made" href = "mailto:otcl@x.co.uk">
<LINK rel="Contents" href="cover.html">
<LINK rel="Previous" href="LangRef.html">
<LINK rel="Next" href="Example.html">
</HEAD><BODY>

<IMG SRC="ObjectTcl.gif">

<H2>Contents</H2>

<UL>
	<LI><a href="#Introduction">Introduction</a>
	<LI><a href="#Restrictions">Restrictions</a>
	<LI><a href="#Processing">CDL Processing</a>
	<LI><a href="#CDL">Class Definition Language (CDL)</a>
	<UL>
		<LI><a href="#Syntax">Syntax</a>
		<LI><a href="#ArgumentTypes">Argument Types</a>
		<LI><a href="#ReturnTypes">Return Types</a>
	</UL>
	<LI><a href="#CPPObjects">C++ Objects</a>
	<LI><a href="#Exceptions">Exceptions</a>
</UL>

<P><IMG ALIGN=MIDDLE SRC="/skunkware/pics/gif/buttons/line.blue.gif" ALT=""><P>

<a name="Introduction"><H2>Introduction</H2></a>

<P>The Object Tcl extension is implemented in C++ in such a way as to promote
the use and reuse of C++ classes from within Object Tcl scripts.

<P>Object Tcl makes it possible to:

<UL>
<LI>Create, manipulate and destruct C++ classes from within the
Object Tcl domain.

<LI>Create, manipulate and destruct Object Tcl classes, that inherit from
C++ classes, from within the C++ domain.

<LI>Inherit Object Tcl classes from built-in C++ classes. Note that the dynamic
binding of methods crosses the domain from C++ to Object Tcl and
vice versa.

<LI>Pass Object Tcl objects, of a class that inherits from an existing C++
class, into the C++ domain for manipulation and possible destruction.

<LI>Re-implement Object Tcl classes in C++ for performance
improvements and access to the more esoteric OS or third party library
facilities with minimal effort.
</UL>

<P>Object Tcl provides an interpreted extension to the C++ language while
still
maintaining the support for object orientation.

<P>This page describes how C++ classes may be exported to the Object Tcl
system for use from Tcl.

<P><IMG ALIGN=MIDDLE SRC="/skunkware/pics/gif/buttons/line.blue.gif" ALT=""><P>

<a name="Restrictions"><H2>Restrictions</H2></a>

<P>There are a few restrictions on the usage of C++ and Object Tcl. These
restrictions are described below:

<OL>

<LI>C++ makes it possible to have many methods with the same name 
that can be distinguished by their formal arguments. In C++ this is 
called overloading. Tcl is weakly typed and it is therefore impossible 
to disambiguate the methods based on the types of the formal
arguments. For this reason method overloading is not supported.

<P>If a C++ class does have more than one method with a given name 
and it is to be exported to Object Tcl then the <a href="#CDL">CDL</a>
for this class must describe only one of them.

<P>The most common occurrence of overloading is in class constructors. 
Only one constructor for a C++ class may be exported to Object Tcl.
<P>

<LI>C++ provides support for defining the behavior of operations upon 
a class. This is called operator overloading. Object Tcl does not
support this. Operators on a C++ class cannot be exported into Object Tcl.
<P>

<LI>As Tcl is weakly typed, with all types represented as strings, then 
there are restrictions on the parameters and return types that may be 
passed back and forth between the two domains. The 
<a href="#Processing">CDL processor</a> 
is designed in a way to make it easy to build in additional 
type conversion support.
<P>

</OL>

<P><IMG ALIGN=MIDDLE SRC="/skunkware/pics/gif/buttons/line.blue.gif" ALT=""><P>

<a name="Processing"><H2>CDL Processing</H2></a>

<P>The Object Tcl system includes a CDL processor called "cdl".
The CDL
processor takes files in the <a href="#CDL">CDL</a> format and generates
C++ files that will 
bind the application's C++ classes into Object Tcl.

<P>The CDL processor takes three arguments: the first is a flag indicating whether the CDL processor is to generate a header file (-h) or source file (-s), the second is the name of the input
file, 
including suffix, and the third is the output file, including suffix.

<p>For each CDL file, the CDL processor must be invoked twice, once to
generate the header file and once to generate the source file.

<P>Rules can be added to makefiles to automatically take CDL files,
with a
suitable suffix, and generate C++ files that are then compiled into
object files. The source distribution contains examples of makefiles that
have such rules.

<P>The C++ code generated by the CDL processor uses C++ static constructors to 
facilitate the inclusion of an application's C++ classes into the Object Tcl
environment with absolutely no modification of the application code. Only a
relink is necessary.

<P><IMG ALIGN=MIDDLE SRC="/skunkware/pics/gif/buttons/line.blue.gif" ALT=""><P>

<a name="CDL"><H2>Class Definition Language</H2></a>

<P>CDL files contain descriptions of the C++ classes that are to be exported to 
Object Tcl.

<a name="Syntax"><H3>Syntax</H3></a>

<P>The <a href="#Processing">CDL processor</a> is based around a Tcl interpreter
itself, hence 
the familiarity of the CDL syntax.

<P>In a CDL file there are two commands:

<pre>pass -(h|s) <var>arg</var></pre>

<P>and

<pre>class ?-isA <var>classList</var>? <var>name desc</var></pre>

<P>The <code>pass</code> command takes the rest of the arguments and passes them
straight through to the generated C++ file. The <code>pass</code> command is
generally used to place <code>#include</code> directives in the generated C++
but
it is also useful for placing 
comments or version identifiers in the C++ files. The <code>-h</code> or 
<code>-s</code> flag may be used to specify that the <code><var>arg</var></code>
is only passed to the header file or source file respectively. If the
destination flag is omitted then the <code><var>arg</var></code> will be
passed to both the header and source files.

<P>The <code>class</code> command is used to describe a C++ class to the Object Tcl
system. The <var>name</var> argument is the name of the class. The
<code>-isA <var>classList</var></code> optional parameter can be used to specify 
the list of superclasses, both direct and indirect, of this class.
The list of superclasses is used for coercing the types of objects when
they are passed between Tcl and C++ using the <code>obptr</code> and
<code>obref</code> CDL types.
The <var>desc</var> argument is a 
Tcl script that may use the following commands internally:

<dl>

<dt><code>constructor <var>args</var></code>


<dd>This command describes the constructor for the C++ class that will be 
exported to Object Tcl. The <var>args</var> argument is a Tcl script that may
use the <a href="#ArgumentTypes">argument type</a> commands.

<p>

<dt><code>method <var>name</var> (-dynamic | -static) <var>args rtn</var></code>

<dd>This command describes an instance method that will be exported to 
Object Tcl. The <var>name</var> argument is the name of the 
method; the <code>-dynamic</code> or <code>-static</code> switch indicates whether the 
method is a C++ virtual method or not. The <var>args</var> argument is a Tcl script that may use the <a href="#ArgumentTypes">argument type</a> commands, and the <var>rtn</var>
argument is a script that may use one of the
<a href="#ReturnTypes">return type</a> commands.
<P>A C++ virtual method can be exported as <code>-static</code> in 
which case the dynamic binding will stop at the Object Tcl/C++ 
interface. This may be of use in some cases as the use of the
<code>-dynamic</code> option causes a performance overhead even if the method 
is not redefined in an Object Tcl subclass.

<p>

<dt><code>classMethod <var>name args rtn</var></code>

<dd>This command describes a class method (a C++ static member function) that will be exported to
Object Tcl. The <var>name</var> argument is the name of the
method.
The <var>args</var> argument is a Tcl script that
may use the <a href="#ArgumentTypes">argument type</a> commands, and the <var>rtn</var>
argument is a script that may use one of the <a href="#ReturnTypes">return type</a> commands.

</dl>

<a name="ArgumentTypes"><H3>Argument Types</H3></a>

<P>The <var>arg</var> parameter of the <code>constructor</code>, 
<code>method</code> and
<code>classMethod</code> 
<a href="#Syntax">commands</a> is a Tcl script that can make use of the
following commands:

<UL>
<li><code>int</code>
<li><code>float</code>
<li><code>double</code>
<li><code>str</code>
<li><code>obptr <var>className</var></code>
<li><code>obref <var>className</var></code>
</ul>
<P>The <var>className</var> argument to the <code>obptr</code> and <code>obref</code> commands specifies the
actual class expected by the C++ method.

<P>The <a href="#Processing">CDL processor</a> is designed to make it easy to
support new type 
conversions between the C++ and the Object Tcl domains.

<a name="ReturnTypes"><H3>Return Types</H3></a>

<P>The <var>rtn</var> parameter of the <code>method</code> and 
<code>classMethod</code>
<a href="#Syntax">commands</a> is 
a Tcl script that can make use of the following commands:

<UL>
<li><code>int</code>
<li><code>float</code>
<li><code>double</code>
<li><code>str</code>
<li><code>obptr <var>className</var></code>
<li><code>obref ?-new? <var>className</var></code>
</ul>
<P>The <var>className</var> argument to the <code>obptr</code> and <code>obref</code> commands specifies the
actual class returned by the C++ method.

<p>The <code>-new</code> flag for the <code>obref</code> return type may be
used to indicate that a copy of the returned object should be made on the heap.

<P>As with <a href="#ArgumentTypes">argument types</a>, the <a href="#Processing">CDL processor</a>
is designed to make it easy to add new type conversions between
C++ and the Object Tcl domains.

<P><IMG ALIGN=MIDDLE SRC="/skunkware/pics/gif/buttons/line.blue.gif" ALT=""><P>

<a name="CPPObjects"><H2>C++ Objects</H2></a>

<p>Prior to beta 1.1 of Object Tcl, it was not possible to create a
C++ object from within the C++ domain and then pass it into Object Tcl for
manipulation.

<p>Beta 1.1 of Object Tcl removes this restriction by allowing the C++ domain
to create instances of <code><var>class</var>_otcl</code> with the constructor
described in the CDL description. For example:

<p><code>return new Shape(300,300);</code>

<p>This new Shape object could not be passed back to Object Tcl but now
you can write:

<p><code>return new Shape_otcl(300,300);</code>

<p>and pass the new Shape object into Object Tcl.

<p>This requires the C++ domain to include header files generated by
the <a href="#Processing">CDL processor</a>.

<hr>

<a name="Exceptions"><H2>Exceptions</H2></a>

<p>Dynamic binding of methods makes it possible for a C++ method invocation
to result in the execution of a method described in Tcl. It is quite possible
for the Tcl to be incorrect and generate an exception.

<p>It is possible to catch exceptions in three ways.

<H3>General exception handler</H3>

<p>By default, any exception in a Tcl method body invoked from the C++
domain will result in the error being reported to <code>stdout</code> and the
application terminating with an error status.

<H3>Object exception handler in Tcl</H3>

<p>It is possible to implement an instance method called
<STRONG>otclErrorMethod</STRONG> on an Object Tcl class. This method will be
called on any Tcl exception that occurs when a method is invoked from C++.

<p>The <STRONG>otclErrorMethod</STRONG> takes two parameters. The first parameter
is the name of the method that caused the exception; the second is the error
message generated by the exception.

<H3>Object exception handler in C++</H3>

<p>It is possible to implement an instance method called
<STRONG>otclErrorMethod</STRONG> on a C++ class in the same manner as for
Object Tcl classes described above. This method must be exported to the Object Tcl system via
the CDL description and it must take two arguments, both of which are of type
<code>char *</code>.

 
<P><IMG ALIGN=MIDDLE SRC="/skunkware/pics/gif/buttons/line.blue.gif" ALT=""><P>

<A REL="Contents" HREF = "cover.html">Object Tcl</A> |
<A HREF = "Overview.html">Overview</A> |
<A REL="Previous" HREF = "LangRef.html">Language Reference</A> |
C++ Binding Reference |
<A REL="Next" HREF = "Example.html"><B>Example</B></A> |
<A HREF = "../../../src/Tools/ObjectTcl-1.1">Source Code</A>

<P><IMG ALIGN=MIDDLE SRC="/skunkware/pics/gif/buttons/line.blue.gif" ALT=""><P>

<ADDRESS><A HREF="mailto:otcl@x.co.uk">otcl@x.co.uk</A></ADDRESS>

<P><IMG ALIGN=MIDDLE SRC="/skunkware/pics/gif/buttons/line.blue.gif" ALT="">
<P><A HREF="/skunkware/index.html">
<IMG ALIGN=MIDDLE SRC="/skunkware/pics/gif/buttons/arrow.plain.left.gif"
ALT="">
Return to Welcome Home Page</A> or
<A HREF="Example.html">
Continue to Browse
<IMG ALIGN=MIDDLE SRC="/skunkware/pics/gif/buttons/arrow.plain.right.gif"
ALT=""></A>

</BODY></HTML>
