<HTML>
<HEAD>
<TITLE>USER DATABASE</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF">
<A HREF="index.html"><B>Index</B></A>&nbsp;&nbsp;<A HREF="16.00.SHIPPING.html"><B>Previous:</B> SHIPPING</A>&nbsp;&nbsp;&nbsp;<A HREF="18.00.TRACKING_AND_BACKEND_ORDER_ENTRY.html"><B>Next:</B> TRACKING AND BACKEND ORDER ENTRY</A><HR><H1><A NAME="USER_DATABASE">USER DATABASE</A></H1>
<P>
MiniVend has a user database function which allows customers to save any
pertinent values from their session. It also allows the setting of database
or file access control lists for use in controlling access to pages and
databases on a user-by-user basis.

<P>
The database field names in the user database correspond with the form
variable names in the user session. If you have a column named <CODE>address</CODE>, then when the user logs in the contents of that field will be placed in
the form variable <CODE>address</CODE>, and will then be availabe for display with <CODE>[value address]</CODE>. Similarly, the database value is available with
<CODE>[data table=userdb column=address key=username]</CODE>.

<P>
The 
<FONT SIZE=-1>ASCII</FONT> file for the database will not reflect changes
unless you export the file with <CODE>[tag export userdb][/tag]</CODE>. It is not advisable to edit the 
<FONT SIZE=-1>ASCII</FONT> file, as it will overwrite the real data that is in the 
<FONT SIZE=-1>DBM</FONT> table; user logins and changes would be lost. (This would not happen with 
<FONT SIZE=-1>SQL,</FONT> but editing the 
<FONT SIZE=-1>ASCII</FONT> file would have no effect.) You should probably set the
 <EM>NoImport</EM> configuration directive accordingly.

<P>
This section describes the user database in MiniVend 3.12. Prior to 3.12,
the user database was a demonstration add-on module with a global
subroutine interface. Some of the concepts were the same; the module
interface is much the same; and page code based on the previous version
should work if the <CODE>userdb.cfg</CODE> file is still there.

<P>
The field names to be used are not set in concrete; they may be changed
with options, and fields may be added or subtracted at any time. Most users
will choose to keep the default demo fields for simplicity sake, as they
cover most common needs. As distributed in the demo, the fields are:

<P>
<PRE>    code
    accounts
    acl
    address
    address_book
    b_address
    b_city
    b_country
    b_name
    b_nickname
    b_phone
    b_state
    b_zip
    carts
    city
    country
    db_acl
    email
    email_copy
    fax
    fax_order
    file_acl
    mv_credit_card_exp_month
    mv_credit_card_exp_year
    mv_credit_card_info
    mv_credit_card_type
    mv_shipmode
    name
    order_numbers
    p_nickname
    password
    phone_day
    phone_night
    preferences
    s_nickname
    state
    time
    zip
</PRE>
<P>

<FONT SIZE=-1>A</FONT> few of those fields are special in naming, though all can be changed via an option. 
<FONT SIZE=-1>A</FONT> couple of the fields are reserved for Minivend's use.


<P>
<STRONG>IMPORTANT NOTE:</STRONG> If you are not running with 
<FONT SIZE=-1>PGP</FONT> or other encryption for your credit card numbers, which should 
<FONT SIZE=-1>NEVER</FONT> be done anyway, then it is important that you remove the mv_credit_card_info field from the database.
 

<P>
The special database fields are:

<P>
<PRE>    accounts         Storage for billing accounts book
    address_book     Storage for shipping address book
    b_nickname       Nickname of current billing account
    carts            Storage for shopping carts
    p_nickname       Nickname for current preferences
    preferences      Storage for preferences
    s_nickname       Nickname for current shipping address
    db_acl           Storage for database access control lists
    file_acl         Storage for file access control lists
    acl              Storage for simple integrated access control
</PRE>
<P>
If not defined, the corresponding capability is not available.

<P>

<FONT SIZE=-1>NOTE:</FONT> The fields <CODE>accounts</CODE>, <CODE>address_book</CODE>, <CODE>carts</CODE>, and <CODE>preferences</CODE> should be defined as a 
<FONT SIZE=-1>BLOB</FONT> type if you are using 
<FONT SIZE=-1>SQL.</FONT> This is also suggested for the acl fields if those lists could be large.


<P>
Reserved fields include:

<P>
<PRE>    code        The username (key for the database)
    password    Password storage
    time        Last time of login
</PRE>
<P>
<HR>
<UL><LI><A HREF="17.01.The_userdb_tag.html">The [userdb ...] tag</A></LI>
<LI><A HREF="17.02.Setting_defaults_with_the_UserDB.html">Setting defaults with the UserDB directive</A></LI>
<LI><A HREF="17.03.User_Database_functions.html">User Database functions</A></LI>
<LI><A HREF="17.04.Address_Book.html">Address Book</A></LI>
<LI><A HREF="17.05.Accounts_Book.html">Accounts Book</A></LI>
<LI><A HREF="17.06.Preferences.html">Preferences</A></LI>
<LI><A HREF="17.07.Carts.html">Carts</A></LI>
<LI><A HREF="17.08.Controlling_page_access_with_Use.html">Controlling page access with UserDB</A></LI>
</UL><BR><HR><A HREF="index.html"><B>Index</B></A>&nbsp;&nbsp;<A HREF="16.00.SHIPPING.html"><B>Previous:</B> SHIPPING</A>&nbsp;&nbsp;&nbsp;<A HREF="18.00.TRACKING_AND_BACKEND_ORDER_ENTRY.html"><B>Next:</B> TRACKING AND BACKEND ORDER ENTRY</A></BODY></HTML>
